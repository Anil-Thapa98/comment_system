<div class="mb-2 reply-item" id="comment-{{ reply.id }}">
    <div class="card-body p-2">
        <!-- Display Reply Content -->
        <div id="comment-content-{{ reply.id }}">
            <h6 class="mb-0 me-2" style="font-size: 14px; font-weight: 600;">{{ reply.user.username }}</h6>
            <p class="mb-0" style="font-size: 14px;">
                <span class="username-mention">@{{ reply.parent.user.username }}</span>: {{ reply.content }}
            </p>
        </div>

        <!-- Like, Reply, Edit, Delete Buttons -->
        <div class="d-flex align-items-center" style="font-size: 12px;">
            <!-- Like Button -->
            <button class="btn btn-link p-0 me-2 text-decoration-none"
                    hx-post="{% url 'comments:like_comment' reply.id %}"
                    hx-target="#comment-{{ reply.id }} .like-btn"
                    hx-swap="innerHTML">
                <span class="like-btn text-primary">👍 Like ({{ reply.total_likes }})</span>
            </button>

            <!-- Reply Button -->
            <button class="btn btn-link p-0 me-2 text-decoration-none reply-btn"
                    onclick="toggleReplyForm('{{ reply.id }}')">
                💬 Reply
            </button>

            <!-- Edit Button -->
            <button class="btn btn-link p-0 me-2 text-decoration-none"
                    onclick="toggleEditForm('{{ reply.id }}')">
                ✏️ Edit
            </button>

            <!-- Delete Button -->
            <button class="btn btn-link p-0 text-decoration-none text-danger"
                    hx-post="{% url 'comments:delete_comment' reply.id %}"
                    hx-target="#comment-{{ reply.id }}"
                    hx-swap="outerHTML">
                🗑 Delete
            </button>
        </div>

        <!-- Reply Form (Hidden by Default) -->
        <div id="reply-form-{{ reply.id }}" class="mt-2" style="display: none;">
            <form hx-post="{% url 'comments:add_reply' reply.id %}" 
                  hx-target="#replies-{{ reply.id }}" 
                  hx-swap="beforeend"
                  hx-on::after-request="document.getElementById('reply-form-{{ reply.id }}').style.display = 'none'; this.reset();"
                  hx-indicator="#loading-spinner">
                {% csrf_token %}
                <div class="form-group">
                    <textarea class="form-control" name="content" rows="2" placeholder="Write a reply..." required></textarea>
                </div>
                <button type="submit" class="btn btn-success btn-sm">Submit Reply</button>
                <button type="button" class="btn btn-secondary btn-sm" onclick="toggleReplyForm('{{ reply.id }}')">Cancel</button>
            </form>
        </div>

        <!-- Nested Replies -->
        <div id="replies-{{ reply.id }}">
            {% for nested_reply in reply.replies.all %}
                {% include "comments/reply.html" with reply=nested_reply %}
            {% endfor %}
        </div>
    </div>
</div>

<script>
function toggleReplyForm(replyId) {
    let replyForm = document.getElementById(`reply-form-${replyId}`);
    if (replyForm) {
        replyForm.style.display = replyForm.style.display === "none" ? "block" : "none";
    }
}
</script>
